


### 0.í™˜ê²½ì„¤ì •

https://mas.owasp.org/crackmes/ ì—ì„œ Uncrackable level3.apk ì„¤ì¹˜ í›„ ì§„í–‰


---

### 1. ì†”ë£¨ì…˜ íƒì§€ ìš°íšŒ


#### Step 1. ë¡œì§ íŒŒì•…


- ![img.png](UnCrackLevel3_1.png)

ë£¨íŒ… íƒì§€ ì¤‘ì¸ ê²ƒì„ í™•ì¸í•¨


- ![img_6.png](UnCrackLevel3_2.png)

checkRoot1 ë©”ì„œë“œëŠ” í™˜ê²½ë³€ìˆ˜ì— ë“±ë¡ëœ íŒŒì¼ ì¤‘ suê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ ë£¨íŒ… ì—¬ë¶€ë¥¼ íŒë‹¨ 

checkRoot2 ë©”ì„œë“œëŠ” í…ŒìŠ¤íŠ¸í‚¤ê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ë£¨íŒ… ì—¬ë¶€ë¥¼ íŒë‹¨

checkRoot3 ë©”ì„œë“œëŠ” ë£¨íŒ…ëœ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ì•Œë ¤ì§„ íŒ¨í‚¤ì§€, íŒŒì¼ë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ ë£¨íŒ… ì—¬ë¶€ë¥¼ íŒë‹¨

ìš°íšŒë¥¼ ìœ„í•´ ì½”ë“œë¥¼ ì‘ì„±í•¨

```js
Java.perform(function () {
    var java_lang_System = Java.use('sg.vantagepoint.util.RootDetection');
    java_lang_System.checkRoot1.implementation = function () {
        if (this.checkRoot1()) { console.log("[*] CheckRoot1 is bypassed"); } return false;
    }
    java_lang_System.checkRoot2.implementation = function () {
        if (this.checkRoot2()) { console.log("[*] CheckRoot2 is bypassed"); } return false;
    }
    java_lang_System.checkRoot3.implementation = function () {
        if (this.checkRoot3()) { console.log("[*] CheckRoot3 is bypassed"); } return false;
    }
});
```

í›„í‚¹í•˜ì—¬ ì‹¤í–‰ ì‹œ 

- ![img_8.png](UnCrackLevel3_3.png)

ë‹¨ë§ê¸°ì—ì„œ í™•ì¸ ì‹œ ì•±ì´ ì •ìƒì ì¸ ì¢…ë£Œê°€ ì•„ë‹ˆë¼ ì™„ì „íˆ ì¢…ë£Œë¨

ë˜í•œ

- ![img_9.png](UnCrackLevel3_4.png)

í”„ë¦¬ë‹¤ì—ì„œ ë¡œê·¸ í™•ì¸ ì‹œ ë³´ë©´

`signal 6 (SIGABRT), code -6 (SI_TKILL)` 

ì´ í¬ë˜ì‹œëŠ” ì•±ì´ ì¼ë¶€ëŸ¬ ìê¸° ìì‹ ì„ ì£½ì¸ ê²ƒì´ê³ , ì •ìƒ ì¢…ë£Œë‘ ì™„ì „íˆ ë‹¤ë¥´ë‹¤

ğŸ‘‰ ì˜ë„ì ìœ¼ë¡œ í¬ë˜ì‹œ ë°œìƒí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì „í˜•ì ì¸ anti-debug / anti-frida íŠ¸ë¨í´ë¦°


/lib/arm64/libfoo.so ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì˜ `0x000031ac` ì—ì„œ goodbye() í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¨ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.



---

#### Step 2. so íŒŒì¼ ë¶„ì„

libfoo.so íŒŒì¼ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ 

> apk íŒŒì¼ì˜ í™•ì¥ìë¥¼ zip ìœ¼ë¡œ ë°”ê¾¼ ë’¤ ì••ì¶• í•´ì œí•˜ë©´ lib í´ë” ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ì¶œì´ ê°€ëŠ¥í•˜ë‹¤


ë‹¨ë§ê¸°ì˜  OS bitë¥¼ í™•ì¸í•œë‹¤.


`getprop ro.product.cpu.abi`

- ![img_50.png](Uncrackablelevel2_9.png)

lib í´ë” ë‚´ ë‹¨ë§ê¸° OSì— ë§ëŠ” í´ë”ë¡œ ì´ë™í•œ ë’¤ libfoo.so íŒŒì¼ì„ Ghidra ë‚˜ IDA ìœ¼ë¡œ ë¶„ì„ ì§„í–‰í•˜ë©´ ëœë‹¤


- ![img_10.png](UnCrackLevel3_5.png)

Ghdiraì˜ ì½”ë“œ ë¸Œë¼ìš°ì €ì˜ ìµœìƒë‹¨ì— ê°€ë©´ `0x00100000` ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆëŠ”ë° ê¸°ì¤€ ì£¼ì†Œì´ë‹¤

ë‚´ê°€ ì°¾ê³ ìí•˜ëŠ” ì£¼ì†Œ `0x000031ac`ëŠ” ìƒëŒ€ì£¼ì†Œì´ë‹ˆ ê¸°ì¤€ ì£¼ì†Œ + ìƒëŒ€ì£¼ì†Œ = `0x00100000` + `0x000031ac` = `0x001031ac` ì´ë‹¤


- ![img_11.png](UnCrackLevel3_6.png)

ëŒ€ë¬¸ì G ë‹¨ì¶•í‚¤ > `0x001031ac` ìœ¼ë¡œ ì´ë™í•˜ë©´

- ![img_12.png](UnCrackLevel3_7.png)

goodbye() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ìœ¼ë¡œ ì´ë™ì´ ê°€ëŠ¥í•¨

ìš°ì¸¡ ë””ì»´íŒŒì¼ ì°½ì˜ ì½”ë“œë¥¼ ë¶„ì„í•˜ë©´ ëŒ€ê°• ì•„ë˜ì™€ ê°™ë‹¤.

```text
â€» ì•„ë˜ì˜ ì†ŒìŠ¤ì½”ë“œì— ëŒ€í•œ ë¼ì¸ ë³„ ì„¤ëª…

17 ë¼ì¸ : ë³€ìˆ˜ __streamì— /proc/self/maps íŒŒì¼ì„ ì½ê¸° ê¶Œí•œìœ¼ë¡œ ì½ì–´ë“œë¦°ë‹¤.
18 ë¼ì¸ : íŒŒì¼ì„ ì½ì–´ë“œë¦¬ëŠ”ë° ì‹¤íŒ¨í•˜ë©´ "Error opening /proc/self/maps! Terminating..." ë¬¸êµ¬ë¥¼ pcVar1ì— ì €ì¥í•œë‹¤.
24 ë¼ì¸ : __streamì—ì„œ ìµœëŒ€ 0x200(512)ë°”ì´íŠ¸ê¹Œì§€ì˜ ë¬¸ìì—´ì„ ì½ì–´ì„œ acStack_238 ë²„í¼ì— ì €ì¥í•œë‹¤.
25 ë¼ì¸ : fget() í•¨ìˆ˜ë¡œ ë¬¸ìì—´ì„ ì„±ê³µì ìœ¼ë¡œ ì½ì€ ê²½ìš° ë°˜ë³µë¬¸ì„ ì¤‘ë‹¨í•œë‹¤.
36 ë¼ì¸ : acStack_238 ë¬¸ìì—´ì—ì„œ "frida" íŒ¨í„´ì„ ì°¾ì€ ê²½ìš° ë°˜ë³µë¬¸ì„ ì¢…ë£Œí•œë‹¤.
39 ë¼ì¸ : acStack_238 ë¬¸ìì—´ì—ì„œ "xposed" íŒ¨í„´ì„ ì°¾ì€ ê²½ìš° ë”ì´ìƒ ë°˜ë³µí•˜ì§€ ì•ŠëŠ”ë‹¤.
40 ë¼ì¸ : "Tampering detected! Terminating..." ë¬¸êµ¬ë¥¼ pcVar1ì— ì €ì¥í•œë‹¤.
43 ë¼ì¸ : pcVar1ì— ì €ì¥ëœ ë¬¸êµ¬ë¥¼ "UnCrackable3" íƒœê·¸ë¡œ "INFO" ë ˆë²¨ì˜ ë¡œê·¸ë¡œ ì¶œë ¥í•œë‹¤.
45 ë¼ì¸ : í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œì‹œí‚¤ê¸°ìœ„í•´ _exit(0) ì½”ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” goodbye() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
```


ì¦‰, frida, xposed íƒì§€ ë¡œì§ì´ë©°

ë°©ì•ˆì€ 2ê°€ì§€ ì •ë„ë¡œ ìƒê°í•  ìˆ˜ ìˆë‹¤.

1. strstr í•¨ìˆ˜ì— í›„í‚¹ì„ ê±¸ì–´ frida, xposed ë¬¸ìì—´ì„ ì°¾ì•˜ì„ ë•Œ ë°˜í™˜ ê°’ì„ 0ìœ¼ë¡œ ë³€ì¡°í•˜ì—¬ íƒì§€ ê¸°ëŠ¥ì„ ìš°íšŒ, strstr í•¨ìˆ˜ëŠ” í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì¸ libc.so ë‚´ì— ì¡´ì¬í•¨
2. fopen í•¨ìˆ˜ì— í›„í‚¹ì„ ê±¸ì–´ /proc/self/maps íŒŒì¼ ëŒ€ì‹  /proc/self/stat íŒŒì¼ì„ ë¶„ì„í•˜ë„ë¡ í•˜ì—¬ íƒì§€ ê¸°ëŠ¥ì„ ìš°íšŒ


1ë²ˆì˜ ë°©ë²•ìœ¼ë¡œ ìš°íšŒ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤

ê¸°ì¡´ì˜ RootDetection í´ë˜ìŠ¤ì˜ checkRoot1,2,3 í›„í‚¹ ì½”ë“œë¥¼ ì¶”ê°€í•œ í•œ ìµœì¢… ìš°íšŒ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```js
Java.perform(function () {
    var java_lang_System = Java.use('sg.vantagepoint.util.RootDetection');
    // checkRoot1 ë©”ì„œë“œë¥¼ ìš°íšŒ
    java_lang_System.checkRoot1.implementation = function () {
        if (this.checkRoot1()) {
            console.log("[*] CheckRoot1 is bypassed");  // checkRoot1ì´ í˜¸ì¶œëœ ê²½ìš° ìš°íšŒ ë¡œê·¸ ì¶œë ¥
        }
        return false;  // ë£¨íŒ…ì´ ê°ì§€ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  falseë¥¼ ë°˜í™˜í•˜ì—¬ ë£¨íŒ… ê²€ì‚¬ë¥¼ ìš°íšŒ
    }
    // checkRoot2 ë©”ì„œë“œë¥¼ ìš°íšŒ
    java_lang_System.checkRoot2.implementation = function () {
        if (this.checkRoot2()) {
            console.log("[*] CheckRoot2 is bypassed");  // checkRoot2ê°€ í˜¸ì¶œëœ ê²½ìš° ìš°íšŒ ë¡œê·¸ ì¶œë ¥
        }
        return false;  // ë£¨íŒ…ì´ ê°ì§€ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  falseë¥¼ ë°˜í™˜í•˜ì—¬ ë£¨íŒ… ê²€ì‚¬ë¥¼ ìš°íšŒ
    }
    // checkRoot3 ë©”ì„œë“œë¥¼ ìš°íšŒ
    java_lang_System.checkRoot3.implementation = function () {
        if (this.checkRoot3()) {
            console.log("[*] CheckRoot3 is bypassed");  // checkRoot3ê°€ í˜¸ì¶œëœ ê²½ìš° ìš°íšŒ ë¡œê·¸ ì¶œë ¥
        }
        return false;  // ë£¨íŒ…ì´ ê°ì§€ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  falseë¥¼ ë°˜í™˜í•˜ì—¬ ë£¨íŒ… ê²€ì‚¬ë¥¼ ìš°íšŒ
    }
    
    var x = false;
    
    // ì˜ˆì œ 1: 'libc.so'ì˜ 'strstr' í•¨ìˆ˜ í›…í‚¹
    Interceptor.attach(Module.getExportByName('libc.so', 'strstr'), {
        onEnter: function (args) {
            // 'strstr' í•¨ìˆ˜ì—ì„œ ì²« ë²ˆì§¸ ì¸ì(haystack)ë¥¼ ì½ì–´ë“¤ì„ (ê²€ìƒ‰í•  í° ë¬¸ìì—´)
            var haystack = Memory.readUtf8String(args[0]);
            
            // haystack ë¬¸ìì—´ì— 'frida' ë˜ëŠ” 'xposed'ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬
            if(haystack.indexOf('frida') !== -1 || haystack.indexOf('xposed') !== -1){
                x = true;  // 'frida'ë‚˜ 'xposed'ë¥¼ ì°¾ìœ¼ë©´ í”Œë˜ê·¸ë¥¼ ì„¤ì •
            }
        },
        onLeave: function (retval) {
            // ë§Œì•½ 'frida'ë‚˜ 'xposed'ë¥¼ ì°¾ì€ ê²½ìš°, ë°˜í™˜ê°’ì„ ìˆ˜ì •í•˜ì—¬ í•´ë‹¹ ë¬¸ìì—´ì„ ì°¾ì§€ ëª»í•˜ê²Œ ë§Œë“¬
            if(x){
                retval.replace(0);  // strstrì´ ì°¾ì„ ìˆ˜ ì—†ê²Œ í•˜ì—¬ í›„ì† ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ í•¨
            }
        }
    });
});
```

- ![img_14.png](UnCrackLevel3_8.png)

ë£¨íŒ… ë° Frida, Xposed íƒì§€ ìš°íšŒ ì„±ê³µ!


---

ì°¸ê³ ë¡œ ìœ„ì—ì„œ ë¡œê·¸ë¥¼ í†µí•´ ì–´ë””ì„œ frida ë¥¼ íƒì§€í•˜ëŠ”ì§€ í™•ì¸í•˜ì˜€ë‹¤.

ì´ ë°©ë²• ë§ê³ ë„ Frida ì½”ë“œë¥¼ í†µí•´ ì–´ë””ì„œ Frida íƒì§€ë¥¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤.

```js
Java.perform(function() {
    // "strstr" í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œ í›„í‚¹ì„ ì‹œì‘
    Interceptor.attach(Module.findExportByName(null, "strstr"), {
        onEnter: function(args) {
            // ì²« ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ëœ íŒŒì¼ ì´ë¦„ì„ ì½ì–´ì˜µë‹ˆë‹¤ (strstr í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ì).
            this.file_name = args[1].readCString();
            
            if (/frida/i.test(this.file_name)){
                console.warn("str: ", this.file_name); // ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥ (frida ê´€ë ¨ íŒŒì¼ì´ ë°œê²¬ëœ ê²½ìš°)

                // í˜„ì¬ ìŠ¤ë ˆë“œì˜ ë°±íŠ¸ë ˆì´ìŠ¤ë¥¼ ì¶œë ¥í•˜ì—¬ í•¨ìˆ˜ í˜¸ì¶œ ê²½ë¡œë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
                console.log(Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n\t'));
            }
        }
    });
});

```


- ![img_16.png](UnCrackLevel3_9.png)



libfoo.so íŒŒì¼ì˜ 0x3144 == 0x00003144(ìƒëŒ€ ì£¼ì†Œ) ì—ì„œ frida ë¬¸êµ¬ë¥¼ ë¹„êµí•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤

Ghidraì—ì„œì˜ 0x00100000ëŠ” (ê¸°ì¤€ì£¼ì†Œ)


`0x00100000ëŠ” (ê¸°ì¤€ì£¼ì†Œ)` + `0x00003144(ìƒëŒ€ ì£¼ì†Œ)` = `0x00103144` ì„ ì°¾ìœ¼ë©´ ëœë‹¤

- ![img_17.png](UnCrackLevel3_10.png)

ëŒ€ë¬¸ì G ë‹¨ì¶•í‚¤ > `0x00103144` ìœ¼ë¡œ ì´ë™í•˜ë©´

- ![img_18.png](UnCrackLevel3_11.png)

í•´ë‹¹ ìœ„ì¹˜ì—ì„œ frida ë¬¸ì ë¹„êµí•˜ëŠ” ê³³ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë¡œì§ì„ ë¶„ì„ ê°€ëŠ¥í•˜ë‹¤.

---


### 2. Secret String ê°’ ì•Œì•„ë‚´ê¸°

- ![img_43.png](UnCrackLevel3_12.png)
- ![img_44.png](UnCrackLevel3_13.png)

ì‚¬ìš©ì ì…ë ¥ ê°’ì´ ì‚¬ì „ì— ì •ì˜ëœ ì…ë ¥í•œ ê°’ê³¼ ê°™ì€ì§€ check ê°ì²´ì˜ check_code ë©”ì„œë“œë¡œ ê²€ì¦ ì¤‘ì´ë©°

check ê°ì²´ëŠ” CodeCheck ì´ë‹¤.

- ![img_45.png](UnCrackLevel3_14.png)

ê²€ì¦ ë©”ì„œë“œì¸ check_code ëŠ” ë‚´ë¶€ì˜ native bar í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë¦¬í„´ ë°›ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì¡´ì¬í•˜ëŠ” bar í•¨ìˆ˜ë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•´ ì•„ë˜ì²˜ëŸ¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ì¶œí•˜ì—¬ ë¶„ì„ ì§„í–‰í•œë‹¤.


> apk íŒŒì¼ì˜ í™•ì¥ìë¥¼ zip ìœ¼ë¡œ ë°”ê¾¼ ë’¤ ì••ì¶• í•´ì œí•˜ë©´ lib í´ë” ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ì¶œì´ ê°€ëŠ¥í•˜ë‹¤


ë‹¨ë§ê¸°ì˜  OS bitë¥¼ í™•ì¸í•œë‹¤.


`getprop ro.product.cpu.abi`

- ![img_50.png](Uncrackablelevel2_9.png)

lib í´ë” ë‚´ ë‹¨ë§ê¸° OSì— ë§ëŠ” í´ë”ë¡œ ì´ë™í•œ ë’¤ libfoo.so íŒŒì¼ì„ Ghidra ë‚˜ IDA ìœ¼ë¡œ ë¶„ì„ ì§„í–‰í•˜ë©´ ëœë‹¤



- ![img_57.png](UnCrackLevel3_15.png)

bar í•¨ìˆ˜ ë‚´ while ë°˜ë³µë¬¸ì—ì„œ XOR ì—°ì‚°ì„ í†µí•´ ë°ì´í„° ê²€ì¦ ë¡œì§ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤

ë¶„ì„ ì „ì— ê°€ëŠ¥í•œ ë³€ìˆ˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ `DAT_00115054` ê°’ê³¼ `DAT_00115038` ì— ì–´ë–¤ ê°’ì´ ìˆëŠ”ì§€ ì•Œê¸° ìœ„í•´ ì½”ë“œë¡œ ì•Œì•„ë‚´ì

ì°¸ê³ ë¡œ Ghidraì—ì„œ DAT_ ë’¤ì— ë©”ëª¨ë¦¬ ì£¼ì†Œë¡œ ì„¤ì •í•œ ë³€ìˆ˜ëª…ì€ ê·¸ ì „ì—­ ë³€ìˆ˜ê°€ ë†“ì—¬ ìˆëŠ” ì˜¤í”„ì…‹ì˜ 16ì§„ìˆ˜ í‘œí˜„ì´ë‹¤

ê°ê° ë’¤ì˜ 5ìë¦¿ìˆ˜ëŠ” `15054`, `15038` ì´ë¯€ë¡œ í•´ë‹¹ offset ì„ ë”í•˜ë©´ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ê°’ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```js
// ê¸°ì¡´ ë£¨íŒ… ì½”ë“œ ìƒëµ...

function waitAndDump() {
    // libfoo.so ê°€ ë¡œë“œëëŠ”ì§€ í™•ì¸
    var m = Process.findModuleByName("libfoo.so");
    if (!m) {
        // ì•„ì§ ì•ˆ ì˜¬ë¼ì™”ìœ¼ë©´ ì ê¹ ë’¤ì— ë‹¤ì‹œ ì‹œë„
        setTimeout(waitAndDump, 100);
        return;
    }

    function hexDump(offset) {
        var addr = m.base.add(offset);
        console.log("[*] hexdump offset 0x" + offset.toString(16) +
                    " => addr " + addr);
        console.log(hexdump(addr, {
            offset: 0,
            length: 0x40   // í•„ìš”í•˜ë©´ ê¸¸ì´ ëŠ˜ë ¤ë„ ë¨
        }));
    }
    
    // ì—¬ê¸°ì„œ ì›í•˜ëŠ” ì „ì—­ ì£¼ì†Œ offset ì„ ë„£ëŠ”ë‹¤.
    hexDump(0x15054);
	hexDump(0x15038);
}
// ì•± ì‹œì‘ ì‹œ ë°”ë¡œ ëŒ€ê¸° ë£¨í‹´ ëŒë¦¬ê¸°
setImmediate(waitAndDump);
```

- ![img_58.png](UnCrackLevel3_16.png)

`DAT_00115054` ê°’ì€  0x02, `DAT_00115038` ì€ 24ìë¦¬ì˜ ë¬¸ìì—´  pizzapizzapizzapizzapizz ê°€ ë“¤ì–´ìˆë‹¤.

- ![img_59.png](UnCrackLevel3_17.png)

ì´ë²ˆì—ëŠ” FUN_001010e0(local_68) ì—ì„œ local_68 ê°’ì„ ì•Œì•„ë‚´ì•¼ í•œë‹¤. ì¦‰, FUN_001010e0 í•¨ìˆ˜ì˜ ì¸ìê°’ì„ ì•Œì•„ì•¼ í•œë‹¤.

ì™œëƒí•˜ë©´ ë’¤ì˜ if (*(byte *)(lVar4 + uVar5) != (*(byte *)((long)&DAT_00115038 + uVar5) ^ local_68[uVar5]) ì—ì„œ xor ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— local_68 ì— ì–´ë– í•œ ê°’ì´ ìˆëŠ”ì§€ ë¶„ì„í•  í•„ìš”ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤

FUN_001010e0 í•¨ìˆ˜ë¥¼ ë”ë¸” í´ë¦­í•œë‹¤


- ![img_60.png](UnCrackLevel3_18.png)

ì°¸ê³ ë¡œ Ghidraì—ì„œ FUN_001010e0 ì´ë¦„ì˜ 001010e0 ì€ ê·¸ í•¨ìˆ˜ì˜ ì‹œì‘ ì£¼ì†Œ ê°’ì´ê³ , so ê¸°ì¤€ìœ¼ë¡œ ë³´ë©´ ì˜¤í”„ì…‹ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤

ì¦‰, base ì£¼ì†Œ + `010e0`(FUN_001010e0 ë’¤ì˜ 5ìë¦¿ìˆ˜) ì„ í†µí•´ ì£¼ì†Œê°’ìœ¼ë¡œ í•¨ìˆ˜ í›„í‚¹ì´ ê°€ëŠ¥í•˜ë©° í•´ë‹¹ í•¨ìˆ˜ì˜ ì¸ì ê°’ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```js
// ê¸°ì¡´ ë£¨íŒ… ìš°íšŒ ì½”ë“œ ìƒëµ..
function traceSub(sub_addr) {
    var module_name = "libfoo.so";

    var base = Module.findBaseAddress(module_name);
    if (base === null) {
        console.log("[!] lib not loaded yet, retrying...");
        setTimeout(function () {
            traceSub(sub_addr);
        }, 100);
        return;
    }

    var sub_realaddr = base.add(sub_addr);

    Interceptor.attach(sub_realaddr, {
        onEnter: function (args) {
            console.warn("[+] 0x" + sub_addr.toString(16) + " called");
            if (sub_addr === 0x10e0) {
                console.log("ì¸ì ê°’ ì¶œë ¥ : " + args[0]);
            }
        },
        onLeave: function (retval) {
            console.warn("[-] 0x" + sub_addr.toString(16) + " Exiting");
        }
    });
}
traceSub(0x010e0);
```


- ![img_61.png](UnCrackLevel3_19.png)

í™”ë©´ì— ì•„ë¬´ê°’ì´ë‚˜ ì…ë ¥í•´ì„œ ì‹¤í–‰ê²°ê³¼ë¥¼ ì‚´í´ë³´ë©´ FUN_001010e0 í•¨ìˆ˜ì˜ local_68 ì¸ìëŠ” ë©”ëª¨ë¦¬ ì£¼ì†Œê°’ìœ¼ë¡œ ë³´ì¸ë‹¤.

ê·¸ë ‡ë‹¤ë©´ FUN_001010e0 í•¨ìˆ˜ë¡œ ë“¤ì–´ê°ˆë•Œì˜ local_68 ì˜ ì£¼ì†Œê°’ì— ë“¤ì–´ìˆëŠ” ê°’ê³¼, FUN_001010e0 í•¨ìˆ˜ë¥¼ ë‚˜ì˜¬ë•Œì˜ local_68 ì˜ ì£¼ì†Œê°’ì—ëŠ” ì–´ë–¤ê°’ì´ ë“¤ì–´ìˆëŠ”ì§€ë„ ì‚´í´ë³´ì


```js
// ê¸°ì¡´ ë£¨íŒ… ì½”ë“œ ìƒëµ..
function hexDump(dump_addr){
    var module_base = Module.findBaseAddress("libfoo.so");    // libfoo.so ëª¨ë“ˆì˜ base ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
    if (module_base === null) {
        console.log("Module not loaded yet!");
        return;
    }
    var dump_realaddr = module_base.add(dump_addr);    // base ì£¼ì†Œ + offset = ì‹¤ì œ ë©”ëª¨ë¦¬ ì£¼ì†Œ

    console.log("hexdump start at " + dump_realaddr); // ë¤í”„ ì‹œì‘ ì£¼ì†Œ ì¶œë ¥
    // í•´ë‹¹ ì£¼ì†Œë¶€í„° 32ë°”ì´íŠ¸ë¥¼ hexë¡œ ì¶œë ¥
    console.log(hexdump(dump_realaddr,{offset:0, length:32}));
}


function traceSub(sub_addr){
    var module_base = Module.findBaseAddress("libfoo.so");
    if (module_base === null) {
        console.log("Module not loaded yet!");
        return;
    }

    var sub_realaddr = module_base.add(sub_addr);

    console.log("Tracing " + sub_realaddr);

    Interceptor.attach(sub_realaddr, {   // set hook
        onEnter: function (args) {
            console.warn("[+] " + sub_realaddr + " called");

            if(sub_addr === 0x010e0){
                console.log("local_68: " + args[0]); // ì¸ì ì¶œë ¥
                this.temp = args[0];
                console.log("onEnter sub_10e0:\n" + hexdump(ptr(this.temp),{offset:0, length:32}));
            }
        },
        onLeave: function (retval) {
            if (this.temp !== undefined) {
                console.log("onLeave sub_10e0:\n" + hexdump(ptr(this.temp),{offset:0, length:32}));
            }
            console.warn("[-] " + sub_realaddr + " Exiting");
        }
    });
}

// ğŸ”¹ spawn í›„ ëª¨ë“ˆ ë¡œë”© ëŒ€ê¸°ìš© ë”œë ˆì´
setTimeout(function () {
    traceSub(0x010e0);
}, 3000);  // 3ì´ˆ í›„ ì‹¤í–‰, í•„ìš”í•˜ë©´ ë” ëŠ˜ë¦´ ìˆ˜ ìˆìŒ
```


- ![img_62.png](UnCrackLevel3_20.png)

ì‹¤í–‰ê²°ê³¼ FUN_001010e0 í•¨ìˆ˜ë¥¼ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆë•Œ local_68 ì£¼ì†Œê°’ì— ë“¤ì–´ìˆëŠ” ê°’ì— ë¶„ëª…í•œ ì°¨ì´ê°€ ìˆìŒ

ë“¤ì–´ê°ˆ ë•ŒëŠ”
- local_68 : 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

ë‚˜ì˜¬ ë•ŒëŠ”
- local_68 : 1d 08 11 13 0f 17 49 15 0d 00 03 19 5a 1d 13 15 08 0e 5a 00 17 08 13 14 00 00 00 00 00 00 00 00




ë”°ë¼ì„œ

if (*(byte *)(lVar4 + uVar5) != (*(byte *)((long)&DAT_00115038 + uVar5) ^ local_68[uVar5]) ë™ì‘ì—ì„œ


DAT_00115038 ì— ì €ì¥ë˜ì–´ ìˆëŠ” 24ìë¦¬ì˜ ë¬¸ìì—´ pizzapizzapizzapizzapizz ì™€

local_68 : 1d 08 11 13 0f 17 49 15 0d 00 03 19 5a 1d 13 15 08 0e 5a 00 17 08 13 14 00 00 00 00 00 00 00 00 ì— ëŒ€í•˜ì—¬ 

xor ì—°ì‚°í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.


```js
Java.perform(function () {

    // ===== ê¸°ì¡´ ë£¨íŒ… ìš°íšŒ ì½”ë“œ =====
    var RootDetection = Java.use('sg.vantagepoint.util.RootDetection');

    RootDetection.checkRoot1.implementation = function () { return false; }
    RootDetection.checkRoot2.implementation = function () { return false; }
    RootDetection.checkRoot3.implementation = function () { return false; }

    // ===== XOR ì‹¤í–‰ =====
    function XOR(){
        var zzz = "pizzapizzapizzapizzapizz";
        var kkk = [
            0x1D,0x08,0x11,0x13,0x0F,0x17,
            0x49,0x15,0x0D,0x00,0x03,0x19,
            0x5A,0x1D,0x13,0x15,0x08,0x0E,
            0x5A,0x00,0x17,0x08,0x13,0x14
        ];

        var secret = "";

        for (var i = 0; i < zzz.length; i++) {
            secret += String.fromCharCode(
                zzz.charCodeAt(i) ^ kkk[i]
            );
        }

        console.log("[+] XOR result:", secret);
    }

    XOR();
});

```

- ![img_63.png](UnCrackLevel3_21.png)

í™•ì¸!!















