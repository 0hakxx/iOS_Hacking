# π“‘ λ©μ°¨

- π“‚ [1. IPA νμΌ κµ¬μ΅°](#1-ipa-νμΌ-κµ¬μ΅°)
  - π—‚οΈ [1.1 μ••μ¶• ν•΄μ  μ‹](#1-1-μ••μ¶•-ν•΄μ -μ‹)
  - π“¥ [1.2 μ•± μ„¤μΉ μ‹](#1-2-μ•±-μ„¤μΉ-μ‹)
- π“± [2. iOS μ• ν”λ¦¬μΌ€μ΄μ… κµ¬μ΅°](#2-ios-μ• ν”λ¦¬μΌ€μ΄μ…-κµ¬μ΅°)
- π“± [3. Mach-O λ°”μ΄λ„λ¦¬ νμΌ](#3-mach---o-λ°”μ΄λ„λ¦¬-νμΌ)
  - π—‚οΈ [3.1 Mach-O λ°”μ΄λ„λ¦¬ νμΌ](#31-mach-o-λ°”μ΄λ„λ¦¬-νμΌ)
  - π“¥ [3.2 Mach-O λ°”μ΄λ„λ¦¬ νμΌ ν•μ‹](#32-mach-o-λ°”μ΄λ„λ¦¬-νμΌ-ν•μ‹)
  - π“¥ [3.3 fairplay-drm](#33-fairplay-drm)


# 1. IPA νμΌ κµ¬μ΅°

## 1. 1 μ••μ¶• ν•΄μ  μ‹
IPA νμΌμ„ μ••μ¶• ν•΄μ  ν›„ νμΌ κµ¬μ΅°λ” μ•„λ μ©λ„μ™€ κ°™λ‹¤.

- `Payload` - μµμƒμ„ λ””λ ‰ν† λ¦¬
- `Payload/Application.app` - μ»΄νμΌλ μ• ν”λ¦¬μΌ€μ΄μ…, μ•±μ—μ„ μ‚¬μ©ν•λ” λ¦¬μ†μ¤, info.plist λ“±μ΄ ν¬ν•¨λμ–΄ μμ
  - `info.plist` λ” μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰μ„ μ„ν• κµ¬μ„± νμΌ, λ²„μ „ μ •λ³΄ λ“±μ΄ ν¬ν•¨λμ–΄ μμ.
  - <span style="color:green"> μ§„λ‹¨ μ‹ ν•λ²μ •λ„ κΌ­ ν™•μΈν•΄μ•Όν•¨!
- `Payload/Application.app/AppBinary` - μ‹¤ν–‰κ°€λ¥ν• λ°”μ΄λ„λ¦¬ νμΌ, λ³΄ν†µ DRMμΌλ΅ μ•”νΈν™” λμ–΄μμ–΄ λ³µνΈν™”ν•΄μ•Ό λ¶„μ„μ΄ κ°€λ¥ν•¨.
- `Payload/Application.app/_CodeSignature` - κ°λ°μ μΈμ¦μ„λ΅ λ§λ“  μ• ν”λ¦¬μΌ€μ΄μ… μ„λ… μ •λ³΄κ°€ μμ.
- `iTunesMetadata.plist` - κ°λ°μ μ΄λ¦„, λ²λ“¤ μ‹λ³„μ, μ €μ‘κ¶ μ •λ³΄ λ“±μ μ„Έλ¶€ μ •λ³΄κ°€ ν¬ν•¨λ¨.

## 1. 2. μ•± μ„¤μΉ μ‹ 

![img.png](IPAνμΌκµ¬μ΅°1.png)

![img_1.png](IPAνμΌκµ¬μ΅°2.png)

Bundle Container (`/var/containers/Bundle/Application/$uuid`) 
- uuidλ” **μ•±μ΄ μ„¤μΉ**λ  λ• λ¶€μ—¬λλ” κ³ μ  μ‹λ³„μ β†’ μ¬μ„¤μΉ μ‹ λ³€ν•¨ 
- μ•±μ λ²λ“¤μ„ μ €μ¥ 
- λ²λ“¤μ€ macOS λ° IOSμ—μ„ μ†ν”„νΈμ›¨μ–΄λ¥Ό μ κ³µν•λ” νΈλ¦¬ν• λ°©λ²•μΌλ΅ μ‹¤ν–‰ κ°€λ¥ν• μ½”λ“μ™€  ν•΄λ‹Ή μ½”λ“μ—μ„ μ‚¬μ©ν•λ” λ¦¬μ†μ¤(μ΄λ―Έμ§€, λΉ„λ””μ¤ λ“±)λ¥Ό κ°€μ§„ λ””λ ‰ν† λ¦¬
- <span style="color:green"> β€»λ‚΄κ°€ μ„¤μΉλ μ•± ν™•μΈν•λ ¤λ©΄ μμ •λ λ‚ μ§λ΅ μ •λ ¬ν•΄μ„ λ³΄λ©΄ μ‰½κ² μ°Ύμ„ μ μμ(μ•± μ΄λ¦„μ΄ uuid λ΅ λ‚νƒ€λ‚  μλ„ μμ)

Data Container (`/var/containers/Data/Application/$uuid`)
- μ•±κ³Ό μ‚¬μ©μ λ°μ΄ν„° μ €μ¥
- μ„λΈ λ””λ ‰ν„°λ¦¬λ¥Ό κ°€μ§

iCloud Container (`/private/var/mobile/Library/Mobile Documents`)
- iCloudμ™€ κ΄€λ ¨λ λ°μ΄ν„° μ €μ¥
- iCloud μ§€μ› IOS μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‚¬μ©ν•λ” λ°μ΄ν„°κ°€ ν¬ν•¨λ¨
- μ•±μ—μ„ μ§€μ›ν•λ” λ°μ΄ν„°κ°€ μ €μ¥λ¨, **but μ§„λ‹¨ μ‹ ν™•μΈν•  λ°μ΄ν„°λ” μ—†μ**

AppName.app/ (`/var/containers/Bundle/Application/$uuid/AppName.app`)
- μ•±μ λ²λ“¤λ΅ μΌλ°μ μΌλ΅ μ“°κΈ°κ°€ λ¶κ°€λ¥ν•κ³  μ½κΈ°λ§ κ°€λ¥ 
- but νƒμ¥μƒνƒμ—μ„ μ½κΈ°, μ“°κΈ°, μ‚­μ  κ°€λ¥ 
- iTunesλ‚ iCloudμ— λ°±μ—…λμ§€ μ•μ

Documents/ (`/var/mobile/Containers/Data/Application/$uuid/Documents/`)
- μ‚¬μ©μκ°€ μƒμ„±ν• λ¬Έμ„.λ°μ΄ν„°μ™€ μ™Έλ¶€ μ•±μ—μ„ λ°›μ€ νμΌ μ €μ¥
- μ‚¬μ©μμ—κ² λ…Έμ¶λκ³  μƒμ„±, μ‚­μ , μμ • κ°€λ¥ν• νμΌ ν¬ν•¨ + μ‚¬μ©μκ°€ λ‹¤μ΄λ΅λ“ν• νμΌ
- iTunesλ‚ iCloudμ— λ°±μ—…λ¨(μ‚¬μ©μμ—κ² λ…Έμ¶λλ” λ°μ΄ν„°λ§ μ €μ¥ν•΄μ•Ό ν•¨)
- <span style="color:green"> β€» μ¤‘μ”μ •λ³΄ μ΅΄μ¬ μ‹ μ·¨μ•½μ !


Library/ (`/var/mobile/Containers/Data/Application/$uuid/Library/`)
- μ μ € λ°μ΄ν„° νμΌ λ° μ„μ‹νμΌμ„ μ μ™Έν• λ¨λ“  νμΌ κ΄€λ¦¬
- Application Support, Caches λ””λ ‰ν„°λ¦¬λ¥Ό μ£Όλ΅ μ‚¬μ©λκ³ , Caches λ””λ ‰ν„°λ¦¬λ¥Ό μ μ™Έν• λ””λ ‰ν„°λ¦¬λ” iTunesλ‚ iCloudμ— λ°±μ—…λ¨
- <span style="color:green"> β€» μ¤‘μ”μ •λ³΄ μ΅΄μ¬ μ‹ μ·¨μ•½μ !, λ°±μ—…λλ” λ””λ ‰ν† λ¦¬μ— μ¤‘μ”μ •λ³΄λ‚ ν‰λ¬Έλ°μ΄ν„°κ°€ μμΌλ©΄ μ·¨μ•½μ !

Library/Application support/ (`/var/mobile/Containers/Data/Application/$uuid/Library/Application Support/`)
- μ•±μ„ μ‹¤ν–‰ν•λ” λ° μ‚¬μ©λλ” ν΄λ”λ΅ μ‚¬μ©μμ—κ² λ³΄μ΄μ§€ μ•μ(νƒμ¥ μ‹ ν™•μΈ κ°€λ¥)
- μ•±μ΄ μƒμ„±ν•κ³  κ΄€λ¦¬ν•λ” λ°μ΄ν„°,  μ„¤μ •, ν…ν”λ¦Ώ λ“±(μ•± μƒμ„± λ°μ΄ν„°λΌκ³  μƒκ°ν•λ©΄ μΆ‹μ)

Library/Caches/ (`/var/mobile/Containers/Data/Application/$uuid/Library/Caches/`)
- λ°μ΄ν„° μΊμ‹ νμΌμ„ μ €μ¥ν•λ” κ³³μΌλ΅ μ•± μ„±λ¥μ„ μ„ν• λ©μ μΌλ΅ μ΅΄μ¬
- λ””μ¤ν¬ κ³µκ°„ ν™•λ³΄λ¥Ό μ„ν•΄ μ‚­μ ν•  μ μμΌλ―€λ΅ μ‰½κ² μ¬μƒμ„± κ°€λ¥ν• νμΌ

Library/Preferences  (`/var/mobile/Containers/Data/Application/$uuid/Library/Preferences/`)
- μ•± μ¤‘μ” μ„¤μ •μ •λ³΄κ°€ λ‹΄κ²¨μλ” λ””λ ‰ν† λ¦¬ + μ¤‘μ”μ •λ³΄
- <span style="color:green"> β€» λ°λ“μ‹ ν™•μΈν•΄μ•Όν•¨

tmp (`/var/mobile/Containers/Data/Application/$uuid/tmp`)
- μ„μ‹νμΌμ„ μ„ν• μ €μ¥μ†λ΅ μ•± μ‹¤ν–‰ν•λ”λ° ν•„μ” μ—†λ” νμΌ
- λ°±μ—…λμ§€ μ•κ³  μ•±μ΄ μ‹¤ν–‰λμ§€ μ•μΌλ©΄ λ””λ ‰ν„°λ¦¬λ¥Ό λΉ„μ›€
- but, ν•λ²μ •λ„λ” μ²΄ν¬ν•΄μ„ μ¤‘μ”μ •λ³΄ λ‚¨κΈ°λ”μ§€ ν™•μΈν•λ©΄ μΆ‹μ

λ£¨νΈ(`/`) 
- νƒμ¥λ λ””λ°”μ΄μ¤μ—μ„λ” λ£¨νΈλ””λ ‰ν„°λ¦¬(`/`) μ•„λμ λ¨λ“  νμΌκ³Ό λ””λ ‰ν„°λ¦¬μ— μ½κΈ°&μ“°κΈ° κ¶ν•μ„ κ°€μ§
- κµ¬μ΅°
  - macOS νμΌ μ‹μ¤ν…κ³Ό μ μ‚¬ν• λ””λ ‰ν„°λ¦¬ - Applications, Library, System, User
  - UNIX νμΌ μ‹μ¤ν…κ³Ό μ μ‚¬ν• λ””λ ‰ν„°λ¦¬ - bin, boot, dev, etc, lib, mnt, sbin, tmp, usr, var
  - iOS νμΌ μ‹μ¤ν…μ κ³ μ ν• λ””λ ‰ν„°λ¦¬ - private, cores
  - νƒμ¥ λ„κµ¬μ— λ”°λ¥Έ λ””λ ‰ν„°λ¦¬
  - symbolic link λ””λ ‰ν„°λ¦¬
  - .file - νμΌ μ‹μ¤ν…μ μ†μƒ μ—¬λ¶€λ¥Ό ν™•μΈν•κΈ° μ„ν• λ¬΄κ²°μ„± κ²€μ‚¬μ— μ‚¬μ©λ¨

# 2. iOS μ• ν”λ¦¬μΌ€μ΄μ… κµ¬μ΅°


`/Applications/$app_name.app`
- μ‚¬μ „μ— μ„¤μΉλ μ• ν”λ¦¬μΌ€μ΄μ… λ° νƒμ¥ μ• ν”λ¦¬μΌ€μ΄μ… λ””λ ‰ν„°λ¦¬(μΉ΄λ©”λΌ, safari λ“± κΈ°λ³Έ μ•± + νƒμ¥ μ‹ νƒμ¥λ„κµ¬λ“¤μ„ ν•΄λ‹Ή λ””λ ‰ν† λ¦¬μ— μ €μ¥ν•¨)
- μ‚­μ  ν›„ μ¬μ„¤μΉ λ¶κ°€

`/var/containers/Bundle/Application/$uuid`
- μ•± μ¤ν† μ–΄ μ• ν”λ¦¬μΌ€μ΄μ… λ””λ ‰ν„°λ¦¬ (Bundle Container)(μ•±μ¤ν† μ–΄μ—μ„ μ„¤μΉλ μ•± + μ„μλ΅ μ„¤μΉν• μ•±μ„ ν•΄λ‹Ή λ””λ ‰ν† λ¦¬μ— μ €μ¥ν•¨)
- uuidλ” κ° μ•±λ§λ‹¤ κ³ μ ν•κ² λ¶€μ—¬, μ¬μ„¤μΉ μ‹ λ³€κ²½λ¨ + κ³ μ ν• κ°’μ΄ λ„κµ¬μ— λ”°λΌ λ¬Έμμ—΄λ΅λ„ μ¶λ ¥λλ” κ²½μ°κ°€ μλ‹¤.
- <span style="color:green"> β€»λ‚΄κ°€ μ„¤μΉλ μ•± ν™•μΈν•λ ¤λ©΄ μμ •λ λ‚ μ§λ΅ μ •λ ¬ν•΄μ„ λ³΄λ©΄ μ‰½κ² μ°Ύμ„ μ μμ(μ•± μ΄λ¦„μ΄ uuid λ΅ λ‚νƒ€λ‚  μλ„ μμ)

`/var/mobile/Containers/Data/Application/$uuid`
- λ°μ΄ν„° λ””λ ‰ν„°λ¦¬(Data Container) β†’ μ„μ— Data Container λ™μΌ
- λ¨λ“  μ• ν”λ¦¬μΌ€μ΄μ… λ‚΄λ¶€ λ°μ΄ν„°λ¥Ό μ €μ¥
- κΈ°μ΅΄ μƒνƒμ—μ„λ” ios μƒλ“λ°•μ¤λ΅ μΈν•΄ νΉμ • μ–΄ν”λ¦¬μΌ€μ΄μ…μ—μ„λ§ μ ‘κ·Ό κ°€λ¥ but νƒμ¥ μ‹ μ ‘κ·Όκ°€λ¥
- <span style="color:green"> β€» κ·Έλμ„ μ¤‘μ”νμΌμ΄ μ΅΄μ¬ν•΄μ„λ” μ•λλ‹¤. νƒ€ μ‚¬μ©μκ°€ λ‹¨λ§ νƒμ·¨ ν›„ νƒμ¥μ„ ν†µν•΄ μ¤‘μ”μ •λ³΄ νƒμ·¨ κ°™μ€ μ‹λ‚λ¦¬μ¤λ„ μƒκ°ν•΄μ•Όν•¨.


`/var/Keychains/keychain-2.db`
- μ‚¬μ©μ μ΄λ¦„, ν¨μ¤μ›λ“, μΈμ¦ μ •λ³΄, λ„¤νΈμ›ν¬ μ•”νΈμ™€ κ°™μ€ λ―Όκ°ν• μ •λ³΄λ¥Ό μ €μ¥ν•λ” κ³µκ°„μ΄λ‹¤.
- Sqlite λ°μ΄ν„°λ² μ΄μ¤λ΅ κµ¬μ„±λ νμΌμ΄λ©° λ¨λ“  λ°μ΄ν„°λ” μ•”νΈν™”λ¨
- <span style="color:green"> ν•μ§€λ§ λ³µνΈν™” κ°€λ¥ν• ν΄μ΄ μ΅΄μ¬ν•λ―€λ΅ ν•΄λ‹Ή ν΄μ„ μ‚¬μ©ν•μ—¬ μ¤‘μ”μ •λ³΄ νƒμ·¨κ°€ κ°€λ¥ν•μ§€ ν™•μΈν•΄μ•Όν•¨.


# 3. Mach - O λ°”μ΄λ„λ¦¬ νμΌ

## 3.1 Mach-O λ°”μ΄λ„λ¦¬ νμΌ

- IOS λ””λ°”μ΄μ¤μ— μ„¤μΉλ μ•±μ€ Mach-O λ°”μ΄λ„λ¦¬ νμΌ ν•νƒ 
- Mach-Oλ” Mach object formatμ μ¤„μ„λ§ 
- μ‹¤ν–‰ νμΌ, μ¤λΈμ νΈ μ½”λ“, κ³µμ  λΌμ΄λΈλ¬λ¦¬, λ™μ μΌλ΅ λ΅λ“λ μ½”λ“ λ° μ½”μ–΄ λ¤ν”„λ¥Ό μ„ν• νμΌ ν•μ‹ 
- μ•± μ¤ν† μ–΄μ—μ„ λ‹¤μ΄λ΅λ“ν• μ•±μ€ FairPlay DRMμ„ μ΄μ©ν•΄ μ•”νΈν™”λλ©° λ΅λ”μ— μν•΄ λ°νƒ€μ„ μ¤‘μ— ν•΄λ…λ¨

## 3.2 Mach-O λ°”μ΄λ„λ¦¬ νμΌ ν•μ‹

![img_2.png](IPAνμΌκµ¬μ΅°3.png)

* λ¦¬λ²„μ¤ μ—”μ§€λ‹μ–΄λ§ κ³Όμ •μ—μ„ μ μ©ν• μ •λ³΄λ΅, μ„Έ κ°€μ§€ μ„Ήμ…μΌλ΅ λ‚λ‰¨
* Header
  * Mach-O νμΌ μ„¤λ…
  * Mach-O νμΌμ„ μ‹λ³„ν•κ³  μ•„ν‚¤ν…μ²μ™€ νμΌ ν•΄μ„μ— μν–¥μ„ λ―ΈμΉλ” ν”λκ·Έ λ“±μ νμΌ ν¬λ§· μ •λ³΄λ¥Ό ν¬ν•¨
* Load Commands
  * μ„Έκ·Έλ¨ΌνΈμ™€ ν•΄λ‹Ή μ„Ήμ…μ„ μ„¤λ…
  * Header λ‹¤μμ— μ¤λ” μμ—­μΌλ΅ νμΌ λ° λ μ΄μ•„μ›ƒμ— λ€ν• μ„Έλ¶€μ •λ³΄λ¥Ό ν¬ν•¨
* Data
  * μ‹¤μ  μ„Έκ·Έλ¨ΌνΈ λ°μ΄ν„°
  * Load Commandsλ” μ„Έκ·Έλ¨ΌνΈμ™€ μ„Ήμ…μ μ •ν™•ν• λ μ΄μ•„μ›ƒμ„ μ§€μ •ν•μ§€λ§, Data μμ—­μ—λ” ν•λ‚ μ΄μƒμ μ„Έκ·Έλ¨ΌνΈμ— μ‹¤μ  λ°μ΄ν„°λ¥Ό ν¬ν•¨ (νΉμ • νƒ€μ… λλ” μ½”λ“μ λ°μ΄ν„°κ°€ ν¬ν•¨λ¨)

## 3.3 Fairplay DRM
Fairplay DRM
- μ•± μ¤ν† μ–΄μ—μ„ λ‹¤μ΄λ΅λ“ν• μ•±μ€ FairPlay DRMμ„ μ΄μ©ν•΄ μ•”νΈν™”λμ–΄ λ³΄νΈλ¨
- μ•”νΈν™”λ λ°”μ΄λ„λ¦¬ νμΌμ€ μ»¤λ„μ Mach-O λ΅λ”μ— μν•΄ λ°νƒ€μ„ μ¤‘ ν•΄λ…
- Fairplay DRM μ μ© μ—¬λ¶€λ” Otool λ„κµ¬λ¥Ό μ‚¬μ©ν•μ—¬ LC_ENCRYPTION_INFO μ cryptid κ°’μΌλ΅ ν™•μΈ κ°€λ¥
  -  ```shell
     cd /var/containers/Bundle/Application/[$uuid]
     cd [AppName] /
     otool -l [λ°”μ΄λ„λ¦¬ νμΌ] | grep -A4 LC_ENCRYPTION_INFO
     ```
  -  ![img_3.png](IPAνμΌκµ¬μ΅°4.png)
  - 0μ΄λ©΄ μ•”νΈν™” X, 1μ΄λ©΄ μ•”νΈν™” O
- μ•”νΈν™”λ λ°”μ΄λ„λ¦¬λ¥Ό λ¶„μ„ν•κΈ° μ„ν•΄μ„  ν•΄λ…μ΄ ν•„μ” 
  - μ•”νΈν™”λ¥Ό ν•΄λ…ν•λ©΄ λ°”μ΄λ„λ¦¬ μ‘λ™ λ°©μ‹, λ‚΄λ¶€ ν΄λμ¤ κµ¬μ΅° λ“±μ„ μ‰½κ² νμ•… κ°€λ¥ 
  - Class-dump, frida-ios-dump λ„κµ¬λ¥Ό ν†µν•΄ νλ“ κ°€λ¥
  - λ³µνΈν™” λ°©λ²•μ€ λ’¤μ—μ„ μ„¤λ….



